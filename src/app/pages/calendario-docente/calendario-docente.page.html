<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/comunicados"></ion-back-button>
    </ion-buttons>
    <ion-title>Calendário</ion-title>
    <ion-buttons slot="end">
      <ion-menu-button class="menu-button-externo"></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="calendar-container">
    <!-- top banner -->
    <div class="month-banner">
      <div class="month-left">
        <div class="month-day">{{ (current.getDate() | number:'2.0') }}</div>
        <div class="month-sun">☀️</div>
      </div>
      <div class="month-center">
        <div class="month-number">{{ (currentMonth + 1) | number:'2.0' }}</div>
        <div class="month-name">{{ getMonthNameShort(currentMonth) }}</div>
      </div>
      <div class="month-right">
        <div class="year">{{ currentYear }}</div>
      </div>
    </div>

    <!-- month nav -->
    <div class="nav-controls">
      <button class="nav-btn" (click)="prevMonth()">◀</button>
      <div class="nav-title">{{ getMonthNameShort(currentMonth) }} {{ currentYear }}</div>
      <button class="nav-btn" (click)="nextMonth()">▶</button>
    </div>

    <!-- weekdays -->
    <div class="weekday-row">
      <div *ngFor="let w of ['D','S','T','Q','Q','S','S']" class="weekday">{{ w }}</div>
    </div>

    <!-- calendar -->
    <div class="calendar-grid">
      <div *ngFor="let week of weeks" class="week-row">
        <div *ngFor="let day of week"
             class="day-cell"
             [class.out-month]="!day.inMonth"
             (click)="openEdit(day)">
          <div class="day-number" *ngIf="day.inMonth">{{ day.dayNumber }}</div>

          <div *ngIf="day.event" class="event-marker" [ngClass]="day.event.color">
            ✖
          </div>

          <div *ngIf="day.event" class="event-title">{{ day.event.title }}</div>
        </div>
      </div>
    </div>

    <!-- editor panel (bottom) -->
    <div class="editor-panel" [class.open]="panelOpen">
      <div class="grabber"></div>

      <div class="editor-row">
        <label class="label">Nome da Data:</label>
        <input type="text" [(ngModel)]="editTitle" placeholder="Ex: Prova, Aula, Reunião" />
      </div>

      <div class="editor-row small">
        <label class="label">Dia:</label>
        <div class="day-badge">{{ editingDateIso ? (editingDateIso.split('-')[2]) : '--' }}</div>
        <div class="spacer"></div>
        <button class="save-btn" (click)="saveEdit()">Salvar</button>
      </div>

      <div class="editor-row color-row">
        <div class="color-option" [class.selected]="editColor==='green'" (click)="editColor='green'">
          <div class="color-dot green"></div>
          <div class="color-label">Verde</div>
        </div>

        <div class="color-option" [class.selected]="editColor==='red'" (click)="editColor='red'">
          <div class="color-dot red"></div>
          <div class="color-label">Vermelho</div>
        </div>

        <div class="color-option" [class.selected]="editColor==='none'" (click)="editColor='none'">
          <div class="color-dot none"></div>
          <div class="color-label">Nenhuma</div>
        </div>
      </div>

      <div class="editor-actions">
        <button class="remove-btn" (click)="removeEdit()">Remover</button>
        <button class="cancel-btn" (click)="cancelEdit()">Cancelar</button>
      </div>
    </div>
  </div>
</ion-content>